---
title: "MCA Analysis "
output:
  pdf_document:
    highlight: tango
    fig_width: 7
    fig_height: 6
    fig_caption: true
    toc: true
    toc_depth: 4
    number_sections: true
---
```{r include=FALSE}
# Prepending general purpose libraries
source("../library.gnr/head.R")

# Requiring libraries, installing if needed
fun.install.require(c("rmarkdown", "beepr", "ggplot2", "xtable", "ade4"))

# Loading the mca output generated by 04.mca.R
load("../data.gnr/mca.output.Rdata")

# Loading cluster membership data generated by 03.cca.R
load("../data.gnr/cca.membership.Rdata")

# Loading the list with different mca analysis for each cca cluster
load("../data.gnr/mca.cluster.output.Rdata")

# Loading cca zero cluster
load("../data.gnr/cca.zeros.Rdata")

# Loading the music data
load("../data.gnr/music.Rdata")
# Array of descriptors
arr.groupby <- c("gender","age5", "occupation", "educ3", "habitat", "fam.3niv")
df.descriptors  <- df.music[, c(169, 171, 174, 167, 185, 181)]
df.descriptors  <- df.descriptors[-cca.zeros, ]
```


# Summary

# XX Graph With All Observations Without Descriptors

```{r, results='asis', echo=F, fig.width=9, fig.height=5.5}
s.arrow(mca.output$co, xax=1, yax=2, boxes=F, clabel=0.75, possub="topleft") 
```

# XX Descriptors

```{r, results='asis', echo=F, fig.width=9, fig.height=5.5}
s.arrow(supcol(mca.output , data.frame( scalewt( data.matrix(df.descriptors))))$cosup, clab = 1)

# XX Graph With All Observations Without Descriptors

```{r, results='asis', echo=F, fig.width=9, fig.height=5.5}
s.arrow(mca.output$co, xax=1, yax=2, boxes=F, clabel=0.75, possub="topleft") 
s.arrow(supcol(mca.output , 4 * data.frame( scalewt( data.matrix(df.descriptors))))$cosup , add.p = TRUE, clab = 0.5)
```

```{r, results='asis', echo=F, fig.width=9, fig.height=5.5}
cat("\n\n \\pagebreak \n\n")

# for each cca module plot the mca graph
for(cnt.i in 1:length(levels(as.factor(cca.membership)))){
  cat(sprintf("\n\n## XX Graph For Observations In CCA Module %s \n\n", cnt.i))
  tmp.mca.output <- mca.cluster.output[[cnt.i]]

  s.arrow(tmp.mca.output$co, xax=1, yax=2, boxes=F, clabel=0.75, possub="topleft", sub=sprintf("Module %s",cnt.i))
  s.arrow(supcol(tmp.mca.output , 4 * data.frame( scalewt( data.matrix(df.descriptors[cca.membership == cnt.i, ]))))$cosup , add.p = TRUE, clab = 0.5)

  cat("\n\n \\pagebreak \n\n")
}
```

# XX Graph Colored by CCA clusters

```{r, results='asis', echo=F, fig.width=9, fig.height=5.5}
# Different colors for each cluster
color <- c("red", "green", "blue")
# Ploting cellipse mca groups colored by cca clusters
s.class(mca.output$li, as.factor(cca.membership), cellipse = 2, col=color)


# prqnt(boxplot(mca.output))
# print(scatter.dudi(mca.output))
# print(apply(mca.output$cr, 2, mean))
# print(mca.output$eig[1:mca.output$nf])
# scatter(mca.output)
# s.value(mca.output$li, mca.output$li[,2])
```
