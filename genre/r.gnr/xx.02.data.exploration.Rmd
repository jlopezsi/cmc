---
title: "Data Exploration"
output:
  pdf_document:
    highlight: tango
    fig_width: 7
    fig_height: 6
    fig_caption: true
    toc: true
    toc_depth: 4
    number_sections: true
---
```{r include=FALSE}

source("../library.gnr/head.R")

# Loads libraries
fun.install.require(c("beepr", "circlize","ggplot2","xtable","stats", "rapport"))

# Loads music genres data
load("../data.gnr/music.Rdata")

# Descriptors
arr.groupby <- prj.descriptors.col.names

arr.categorical         <- c("Interests", "Genres")

arr.interests           <- c("interest.clasicm","interest.concertam"
                             ,"interest.listenm","interest.music")

arr.genres              <- c("ballad", "flamenco" , "spanishpoprock"
                             , "jazz", "rap", "opera")


attach(df.music)
```

\newpage

```{r, results='asis', echo=F, warning=F}
for(v in c(prj.descriptors.col.names, prj.genres.col.names)){
  g <- rapport("Descriptives", data=df.music, var=v, file.path="../r.gnr/", graph.hi.res=T)
  print(g)
  cat("\n\n \\pagebreak \n\n ")
}
```

# Interests

## Descriptives

```{r, results='asis', echo=F, fig.width=9, fig.height=5.5}

for(arr in arr.categorical){
  arr.title <- arr
  arr <- get(paste0("arr.", tolower(arr)))
  cat(sprintf("\n\n## %s \n\n", arr.title))

  cat("\n\n### Descriptives\n\n")

  for(cl in arr){
    cat(sprintf("\n\n### %s \n\n", cl))

    print(xtable(t(table(df.music$interest.music))), type="latex", comment=F)

    cat("\n\n")

    for(gb in arr.groupby){
      gg <- ggplot(df.music, aes_string(x=sprintf("%s",cl))) +
      geom_freqpoly(aes_string(group = sprintf("%s",gb), colour = sprintf("%s",gb))) +
      ggtitle(sprintf("Frequency Polygraph of %s\nGrouped by %s", cl, gb))

      print(gg)
      cat("\n\n \\pagebreak \n\n ")
    }

    #  print(ggplot(df.music, aes(x = cl, color = occupaton5)) + geom_density())
    #  print(ggplot(df.music, aes(x = cl, color = age5)) + geom_density())
    #  print(ggplot(df.music, aes(x = cl, color = educ3)) + geom_density())
  }

  cat("\n\n### Contingencies\n\n")

  for(cmb in combn(arr,2, simplify=F)){
    cat(sprintf("\n\n### %s vs %s\n\n", cmb[1], cmb[2]))

    print(mosaicplot( as.formula(paste("~", cmb[1], "+", cmb[2])), data=df.music,
                     color=2:20))

    mat=table(get(cmb[1]), get(cmb[2]))
    rownames(mat) <- paste(cmb[1], rownames(mat),sep="\n")
    colnames(mat) <- paste(cmb[2], colnames(mat),sep="\n")
    print(chordDiagram(mat, directional = TRUE, transparency = 0.5))
  }

  # Beep after each array
  fun.beep(1)

}

# Beep at the begining of rendering the pdf
fun.beep(2)

```


